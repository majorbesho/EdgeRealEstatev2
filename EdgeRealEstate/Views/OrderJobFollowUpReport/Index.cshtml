<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
@{
    /**/

    /**/

    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_AdminPage.cshtml";
}
<h3 style="text-align:center"> تقرير متابعة امر شغل</h3>
@*@using (Html.BeginForm("ShowList", "PurchaseReport"))
    {*@
<div class="form-horizontal" dir="rtl">
    <div class="form-group">

        @*<div class="col-md-2">
                @(Html.Kendo().DatePicker().Name("FromDate").Format("yyyy/MM/dd").HtmlAttributes(new { @class = "form-control" }))
                @Html.ValidationMessage("FromDate", "", new { @class = "text-danger" })
            </div>
            @Html.Label("FromDate", "من تاريخ", htmlAttributes: new { @class = "control-label col-md-1" })
            <div class="col-md-2">
                @(Html.Kendo().DatePicker().Name("toDate").Format("yyyy/MM/dd").HtmlAttributes(new { @class = "form-control" }))
                @Html.ValidationMessage("toDate", "", new { @class = "text-danger" })
            </div>
            @Html.Label("toDate", "الى تاريخ", htmlAttributes: new { @class = "control-label col-md-1" })*@
        <div class="col-md-2">
            @(Html.Kendo().ComboBox()
               .Name("FromProject")
               .Placeholder("اختر")
               //.DataTextField("barCodeUnv")
               .DataTextField("Aname")
               //.Template("#= barCodeUnv # - #= arName #")
               .DataValueField("id")
               .Filter("contains")
               .MinLength(1)
               .HtmlAttributes(new { style = "padding-bottom:10px;" })
               //.Events(e => e.Change("onComboChange"))
               .DataSource(source =>
               {
                   source.Read(read =>
                   {
                       read.Action("ServerFiltering_GetMainProject", "OrderJobFollowUpReport");
                   })
               .ServerFiltering(true);
               })
            )
        </div>
        @Html.Label("FromProject", " من مشروع :", htmlAttributes: new { @class = "control-label col-md-1" })
        <div class="col-md-2">
            @(Html.Kendo().ComboBox()
               .Name("toProject")
               .Placeholder("اختر")
               //.DataTextField("barCodeUnv")
               .DataTextField("Aname")
               //.Template("#= barCodeUnv # - #= arName #")
               .DataValueField("id")
               .Filter("contains")
               .MinLength(1)
               .HtmlAttributes(new { style = "padding-bottom:10px;" })
               //.Events(e => e.Change("onComboChange"))
               .DataSource(source =>
               {
                   source.Read(read =>
                   {
                       read.Action("ServerFiltering_GetMainProject", "OrderJobFollowUpReport");
                   })
               .ServerFiltering(true);
               })
            )
        </div>
        @Html.Label("toProject", " الى مشروع :", htmlAttributes: new { @class = "control-label col-md-1" })
        <div class="col-md-2">
            @(Html.Kendo().ComboBox()
               .Name("FromCust")
               .Placeholder("اختر")
               //.DataTextField("barCodeUnv")
               .DataTextField("ARName")
               //.Template("#= barCodeUnv # - #= arName #")
               .DataValueField("Id")
               .Filter("contains")
               .MinLength(1)
               .HtmlAttributes(new { style = "padding-bottom:10px;" })
               //.Events(e => e.Change("onComboChange"))
               .DataSource(source =>
               {
                   source.Read(read =>
                   {
                       read.Action("ServerFiltering_GetCustomers", "OrderJobFollowUpReport");
                   })
               .ServerFiltering(true);
               })
            )
        </div>
        @Html.Label("FromCust", " من مقاول :", htmlAttributes: new { @class = "control-label col-md-1" })
        <div class="col-md-2">
            @(Html.Kendo().ComboBox()
               .Name("toCust")
               .Placeholder("اختر")
               //.DataTextField("barCodeUnv")
               .DataTextField("ARName")
               //.Template("#= barCodeUnv # - #= arName #")
               .DataValueField("Id")
               .Filter("contains")
               .MinLength(1)
               .HtmlAttributes(new { style = "padding-bottom:10px;" })
               //.Events(e => e.Change("onComboChange"))
               .DataSource(source =>
               {
                   source.Read(read =>
                   {
                       read.Action("ServerFiltering_GetCustomers", "OrderJobFollowUpReport");
                   })
               .ServerFiltering(true);
               })
            )
        </div>
        @Html.Label("Cust", " الى مقاول :", htmlAttributes: new { @class = "control-label col-md-1" })
    </div>
    <div class="form-group">
        <div class="col-md-2">
            @(Html.Kendo().NumericTextBox().Name("FrombillId").HtmlAttributes(new { @class = "form-control" }))
            @Html.ValidationMessage("FrombillId", "", new { @class = "text-danger" })
        </div>
        @Html.Label("FrombillId", "من رقم", htmlAttributes: new { @class = "control-label col-md-1" })
        <div class="col-md-2">
            @(Html.Kendo().NumericTextBox().Name("tobillId").HtmlAttributes(new { @class = "form-control" }))
            @Html.ValidationMessage("tobillId", "", new { @class = "text-danger" })
        </div>
        @Html.Label("tobillId", "الى رقم", htmlAttributes: new { @class = "control-label col-md-1" })

        <div class="col-md-2">
            @(Html.Kendo().ComboBox()
               .Name("FromSalesMan")
               .Placeholder("اختر")
               //.DataTextField("barCodeUnv")
               .DataTextField("ARName")
               //.Template("#= barCodeUnv # - #= arName #")
               .DataValueField("Id")
               .Filter("contains")
               .MinLength(1)
               .HtmlAttributes(new { style = "padding-bottom:10px;" })
               //.Events(e => e.Change("onComboChange"))
               .DataSource(source =>
               {
                   source.Read(read =>
                   {
                       read.Action("ServerFiltering_GetSalesMan", "OrderJobFollowUpReport");
                   })
               .ServerFiltering(true);
               })
            )
        </div>
        @Html.Label("FromSalesMan", " من مهندس :", htmlAttributes: new { @class = "control-label col-md-1" })
        <div class="col-md-2">
            @(Html.Kendo().ComboBox()
               .Name("toSalesMan")
               .Placeholder("اختر")
               //.DataTextField("barCodeUnv")
               .DataTextField("ARName")
               //.Template("#= barCodeUnv # - #= arName #")
               .DataValueField("Id")
               .Filter("contains")
               .MinLength(1)
               .HtmlAttributes(new { style = "padding-bottom:10px;" })
               //.Events(e => e.Change("onComboChange"))
               .DataSource(source =>
               {
                   source.Read(read =>
                   {
                       read.Action("ServerFiltering_GetSalesMan", "OrderJobFollowUpReport");
                   })
               .ServerFiltering(true);
               })
            )
        </div>
        @Html.Label("toSalesMan", " الى مهندس :", htmlAttributes: new { @class = "control-label col-md-1" })
    </div>
    @*<div class="form-group" dir="rtl">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" class="btn-primary" value="طباعة التقرير" style="text-align:center;background-color: steelblue;color: white;cursor: pointer;" />
                <br />
                <br />
            </div>
        </div>*@
</div>
<br />
@*}*@
@(Html.Kendo().Grid<EdgeRealEstate.Models.ViewModels.OrderJobDetailsViewModel>()
    .Name("grid")
    .Columns(columns =>
    {
        //columns.Bound(p => p.BeginDateAcutely).ClientTemplate("#= kendo.toString(BeginDateAcutely, \"yyyy/MM/dd\") #")
        //.ClientFooterTemplate("الاجمالى");
         columns.Bound(p => p.OrderJobId).Title("رقم امر الشغل")
            .ClientTemplate((@Html.ActionLink("#=OrderJobId#", "Index", "OrderJob"
        , new { id = "#=OrderJobId#" }, null).ToHtmlString())).ClientFooterTemplate("#=count#");

          columns.Bound(p => p.MainProjectName).Title("المشروع الرئيسى")
       .ClientTemplate((@Html.ActionLink("#=MainProjectName#", "Details", "MainProjects"
       , new { id = "#=MainProjectId#" }, null).ToHtmlString()));

        columns.Bound(p => p.contractorName).Title("المقاول")
       .ClientTemplate((@Html.ActionLink("#=contractorName#", "Details", "contractor"
       , new { id = "#=contractorId#" }, null).ToHtmlString()));

        columns.Bound(p => p.SupervisorEngenneringName).Title("المهندس المشرف")
    .ClientTemplate((@Html.ActionLink("#=SupervisorEngenneringName#", "Details", "Engennerings"
    , new { id = "#=SupervisorEngenneringId#" }, null).ToHtmlString()));



        //columns.Bound(p => p.Cost);
        //columns.Bound(p => p.ExecutionTime);
    })
    .Pageable()
    .Sortable()
    .Scrollable()
    .HtmlAttributes(new { @class = "k-rtl" })
    .DataSource(dataSource => dataSource
        .Ajax()
        .Batch(true)
        .ServerOperation(false)
        .Model(model =>
        {
            model.Id(p => p.Id);
            model.Field(p => p.Id).Editable(false);
        })
        .PageSize(20)
                                .Aggregates(aggregates =>
                                {
                                    aggregates.Add(p => p.OrderJobId).Count();
                                    //aggregates.Add(p => p.rowTotal).Sum();
                                    //aggregates.Add(p => p.disNo).Sum();
                                    //aggregates.Add(p => p.tax).Sum();
                                    //aggregates.Add(p => p.net).Sum();
                                })
        .Read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"))
    )
)
<script>
    $('#toCust').change(function () {
        $("#grid").data("kendoGrid").dataSource.read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"));
        $("#grid").css("display", "block");
    });
    $('#FromCust').change(function () {
        $("#grid").data("kendoGrid").dataSource.read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"));
        $("#grid").css("display", "block");
    });
    $('#toProject').change(function () {
        $("#grid").data("kendoGrid").dataSource.read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"));
        $("#grid").css("display", "block");
    });
    $('#FromProject').change(function () {
        $("#grid").data("kendoGrid").dataSource.read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"));
        $("#grid").css("display", "block");
    });
    $('#toSalesMan').change(function () {
        $("#grid").data("kendoGrid").dataSource.read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"));
        $("#grid").css("display", "block");
    });
    $('#FromSalesMan').change(function () {
        $("#grid").data("kendoGrid").dataSource.read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"));
        $("#grid").css("display", "block");
    });
    $('#tobillId').change(function () {
        $("#grid").data("kendoGrid").dataSource.read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"));
        $("#grid").css("display", "block");
    });
    $('#FrombillId').change(function () {
        $("#grid").data("kendoGrid").dataSource.read(read => read.Action("EditingCustom_Read", "OrderJobFollowUpReport").Data("getmasterdata"));
        $("#grid").css("display", "block");
    });
    function getmasterdata() {

        var vFromCust = $("#FromCust").val();
        var vtoCust = $("#toCust").val();
        var vFromProject = $("#FromProject").val();
        var vtoProject = $("#toProject").val();
        var vFromSalesMan = $("#FromSalesMan").val();
        var vtoSalesMan = $("#toSalesMan").val();
        var vFrombillId = $("#FrombillId").val();
        var vtobillId = $("#tobillId").val();
        return {
            "FromCust": vFromCust,
            "toCust": vtoCust,
            "FromProject": vFromProject,
            "toProject": vtoProject,
            "FromSalesMan": vFromSalesMan,
            "toSalesMan": vtoSalesMan,
            "FrombillId": vFrombillId,
            "tobillId": vtobillId,

        };
    }
</script>


